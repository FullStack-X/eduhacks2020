

<div class="layui-card layadmin-header">
    <div class="layui-breadcrumb" lay-filter="breadcrumb">
        <a lay-href="">主页</a>
        <a><cite>数字资源</cite></a>
        <a><cite>课程资料</cite></a>
        <a><cite>资料上传</cite></a>
    </div>
</div>

<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-form layui-card-header layuiadmin-card-header-auto" lay-filter="app-content-list">
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">内容标题</label>
                    <div class="layui-input-inline">
                        <input type="text" name="id" placeholder="请输入" autocomplete="off" class="layui-input" id="title">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">课程名称</label>
                    <div class="layui-input-inline">
                        <input type="text" name="author" placeholder="请输入" autocomplete="off" class="layui-input" id="course">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">文件类型</label>
                    <div class="layui-input-inline">
                        <select name="label" id="type">
                            <option value=""></option>
                            <option value="0">作业</option>
                            <option value="1">测试</option>
                            <option value="2">资料</option>
                            <option value="3">视频</option>
                            <option value="4">其他</option>
                        </select>
                    </div>
                </div>
                <div class="layui-inline">
                    <button class="layui-btn layuiadmin-btn-list" lay-submit lay-filter="LAY-app-contlist-search">
                        <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="layui-card-body">
            <div style="padding-bottom: 10px;">
                <div class="layui-upload-drag" id="uploadfile">
                    <i class="layui-icon"></i>
                    <p>点击上传，或将文件拖拽到此处</p>
                    <p style="color: lightgray">(最大允许上传200M)</p>
                    <div class="layui-hide" id="uploadView">
                        <!--              <hr>-->
                        <!--              <img src="" alt="上传成功后渲染" style="max-width: 196px">-->
                    </div>
                </div>
            </div>
            <table id="LAY-app-content-list" lay-filter="LAY-app-content-list"></table>
            <script type="text/html" id="buttonTpl">
                {{#  if(d.status){ }}
                <button class="layui-btn layui-btn-xs">审核通过</button>
                {{#  } else { }}
                <button class="layui-btn layui-btn-primary layui-btn-xs">待审核</button>
                {{#  } }}
            </script>
            <script type="text/html" id="typeTpl">
                {{#  if(d.type === 0){ }}
                <span>作业</span>
                {{#  } else if(d.type === 1){ }}
                <span>测试</span>
                {{#  } else if(d.type === 2){ }}
                <span>word</span>
                {{#  } else if(d.type === 3){ }}
                <span>ppt</span>
                {{#  } else if(d.type === 4){ }}
                <span>视频</span>
                {{#  } else if(d.type === 5){ }}
                <span>其他</span>
                {{#  } }}
            </script>
            <script type="text/html" id="table-content-list">
                <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="edit"><i
                        class="layui-icon layui-icon-edit"></i>编辑</a>
                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><i
                        class="layui-icon layui-icon-delete"></i>删除</a>
            </script>
        </div>
    </div>
</div>

<script>
    layui.use('contlist', layui.factory('contlist')).use(['admin', 'contlist', 'table', 'upload'], function () {
        var $ = layui.$
            , admin = layui.admin
            , view = layui.view
            , table = layui.table
            , form = layui.form
            , upload = layui.upload;

        form.render(null, 'app-content-list');
        upload.render({
            elem: '#uploadfile'
            , url: 'https://httpbin.org/post' //改成您自己的上传接口
            , headers: {token: '请求头'}
            , accept: ['file', 'images', 'video']
            , exts: 'zip|rar|7z|jpg|png|gif|bmp|jpeg|mp4|pdf|md|doc|mov|avi|pptx|txt|ppt'
            , multiple: true
            , size: '204800'
            , done: function (res) {
                if(res.code === 0){
                    layer.msg('正在上传..', {time: 2000}, function () {
                        layer.msg('上传成功！请等待审核..');
                    })
                }
            }
            , error: function () {
                layer.msg('请求异常')
            }
        });

        //监听搜索
        form.on('submit(LAY-app-contlist-search)', function () {
            var $title = $.trim($('#title').val()); //去空格
            var $course = $.trim($('#course').val());
            var $type = $.trim($('#type').val());
            //执行重载
            if ($title || $course || $type) {
                table.reload('LAY-app-content-list', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    },
                    where: {
                        title: $title,
                        course: $course,
                        type: $type
                    }
                });
            }
        });
    });
</script>
